"use strict";angular.module("app",["ngSanitize","ngMessages","ui.router","angular-jwt"]).constant("myConfig",{server:"http://localhost:3000"}).run(["$rootScope","$state","jwtHelper",function(t,e,o){t.$on("$stateChangeStart",function(t,n){if("/login"!==n.url){var r=localStorage.getItem("token");r&&!o.isTokenExpired(r)||(t.preventDefault(),localStorage.removeItem("token"),e.transitionTo("login"))}})}]).config(["$stateProvider","$urlRouterProvider","$httpProvider","jwtOptionsProvider",function(t,e,o,n){n.config({whiteListedDomains:["localhost"],tokenGetter:[function(){return localStorage.getItem("token")}]}),o.interceptors.push("jwtInterceptor"),e.otherwise("login"),t.state("home",{url:"/home",templateUrl:"views/home.html",controller:"homeCtrl"}).state("login",{url:"/login",templateUrl:"views/login.html",controller:"authCtrl"})}]),angular.module("app").factory("authService",["$http","myConfig",function(t,e){var o={};return o.Login=function(o,n){t.post(e.server+"/auth/login",o).then(function(t){n(t.data)})},o}]),angular.module("app").factory("homeService",["$http","myConfig",function(t,e){var o={};return o.startMonitor=function(o,n){t.post(e.server+"/monitor/start",{folder:o}).then(function(t){n(t.data)})},o.stopMonitor=function(o){t.post(e.server+"/monitor/stop").then(function(t){o(t.data)})},o.getLogs=function(o){t.get(e.server+"/monitor/status").then(function(t){o(t.data)})},o}]),angular.module("app").config(["$httpProvider",function(t){t.interceptors.push("responseErrorFact")}]),angular.module("app").factory("responseErrorFact",["$q","$injector",function(t,e){return{responseError:function(o){if(403===o.status){e.get("$state").go("login")}return t.reject(o)}}}]),angular.module("app").controller("authCtrl",["$scope","authService","$state",function(t,e,o){t.formData={},t.login=function(){e.Login(t.formData,function(e){"success"===e.status?(localStorage.setItem("token",e.token),o.go("home")):t.error="User not found."})}}]),angular.module("app").controller("homeCtrl",["$scope","homeService","$interval",function(t,e,o){function n(){r=o(function(){e.getLogs(function(e){t.logs=e})},1e3)}t.listening=!1,t.folders=["folder1"];var r="";t.folder=t.folders[0],t.start=function(){t.folder?(t.stop(),e.startMonitor(t.folder,function(e){"success"===e.status?(t.error="",t.listening=!0,n()):t.error="Error: "+e.msg})):t.error="Please enter folder path"},t.stop=function(){r&&(o.cancel(r),r="",e.stopMonitor(function(e){"success"===e.status&&(t.listening=!1)}))},t.$on("$destroy",function(){t.stop()})}]),angular.module("app").filter("statusFilter",function(){return function(t){return['<span class="text-success"><b>Add</b></span>','<span class="text-warning"><b>Rename</b></span>','<span class="text-danger"><b>Remove<b></span>'][t]}}),angular.module("app").directive("navbar",[function(){return{templateUrl:"scripts/directives/navBar/nav.html",restrict:"E",replace:!0,scope:{},controller:["$scope","$state",function(t,e){t.logout=function(){localStorage.removeItem("token")}}]}}]);